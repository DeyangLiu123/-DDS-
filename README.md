# -DDS-
北京邮电大学电子工程学院2021级数电实验下
![image](https://github.com/DeyangLiu123/-DDS-/assets/162725892/be28e7aa-6703-4d5c-9765-15fedc5a4e4e)
一、设计思路
本设计实现了基于DDS的李萨如图形生成器。首先，本设计使用的正弦波波形是利用matlab生成的
512点波形，然后以 case 语句的形式存储在rom中，构成正弦ROM查找表。本设计中频率与相位的概念
利用频率字和相位字实现。频率字的含义为相位累加器在一个时钟周期内增加的点数，相位字的含义为
波形输出从第几点开始。比如，当频率字为2，相位字为127时，波形的初始相位为 ,频率为DDS模块所
接入的时钟频率的两倍。相位累加器中寄存器的值与频率字相加就得到了当前相位字，也即rom的地
址，将相位调制器中的地址输入rom即可得到应输出的波形，再将波形输出D/A即可得到对应的电信号输
出。李萨图图形生成器实例化了两个上述的DDS，并通过一个 FPreg （存储两个DDS相位字和频率字的
寄存器）实现同步化，以产生符合要求的李萨图图形，此 FPreg 可通过矩阵键盘修改。
二、分块设计
1. Lissahous 模块
本模块是整个设计的顶层模块，本模块中实例化了两个分频器，对50MHz的系统时钟进行了6
分频和6*68分频，DAC模块使用6分频后的时钟，其他模块均是6*68分频；例化了两个DDS模块，
用FPreg同时输出两组频率字和相位字控制两个DDS模块，同时将这两组数据输出到数码管模块进
行显示，DDS输出的数据输入到DAC转化为相应电信号显示在示波器上；FPreg中的相位字和频率
字可以通过4*4键盘修改。
2. rom 模块
本模块使用 case 语句存储了512点正弦波的波形信息。
为节约资源，本模块只存储了前256点，后256点通过对称的数学变化得到。
3. DDS 模块
本模块由相位字和频率字的寄存器、相位累加器、相位调制器、与一个实例化的rom组成，由
FPreg提供的频率字和相位字进入本模块后被寄存器存储。相位累加器在每个时钟周期增加频率字
的值，相位累加器的值加上相位字即最终的地址，将地址输入rom后即可得到相应的正弦波幅值输
出。
4. 4*4键盘 模块
本模块的功能是根据按下的按键输出键值与一个持续一时钟周期的脉冲。输出10000代表没有按键
被按下，输出0****代表有按键被按下且键值为后四位二进制数所代表的值的大小。
本模块基于一个三进程状态机实现。
具体实现原理为：
当状态为idle，列信号输出0000，检测此时行信号是否为1111。
如果是，则证明没有任何按键被按下，继续保持idle。
如果不是，则有按键被按下，进入下一状态check_1st。
当状态为check_1st，列信号输出0111。
如果此时行信号为1111，则证明被按下的按键不在第一列，进入下一状态check_2nd；
如果行信号不是1111，则证明被按下的按键在第一列，此时根据行值判断按下的按键的键值
即可。
后面的状态以此类推。
显然状态机的状态只有在按键按下状态变化时才会变化，当按键持续被按下时状态机不会改
变，所以可以根据状态机状态判断键值，非常的方便。
本模块内有两个寄存器存储上一时钟周期的键值与当前键值，当键值改变时会输出一个持续一
个时钟周期的脉冲信号来触发 FPreg 模块进行频率字和相位字的修改。
5. FPreg 模块
本模块是整个设计运行的核心模块之一，是实现任意频率字和相位字的关键。
本模块内有四个寄存器，分别存储两路DDS的频率字和相位字。
因为相位差是相对概念，所以固定第一路DDS的相位字恒为0，只改变第二路DDS的相位字即
可实现任意相位差。
频率字最高为8位，是正弦函数波形点数（9位，512点）的一半，因为根据奈奎斯特采样定
理，一个正弦波至少得有两个采样点才能包含全部信息。
第一路DDS的频率字最高可到63， 因为原本的计划是在八位数码管上分别十进制显示第一二
路DDS的频率字与第二路DDS的相位字，这样如果第一路DDS的频率字超过一百的话，就需要显示
三个三位十进制数，需要九个数码管，资源显然是不够用的，所以把第一路DDS的频率字限制为6
位，但后来发现十进制译码器过于复杂，消耗的资源也较多，所以改成了16进制限制，这样是可以
显示8位频率字的，但如此之高的频率字必然会伴随极度失真，所以也未再做修改，即保留了第一
路DDS的频率字的大小。
第二路DDS的频率字为8位。
本模块接受来自 4*4键盘 模块的键值与脉冲，当脉冲到来时，模块会根据当前的键值做出相应
操作。具体为当按下第一行的第1、2、3、4个按键时，分别对应第一路DDS频率字+1、+10、归
1、归63；当按下第二行的第1、2、3、4个按键时，分别对应第二路DDS频率字+1、+10、+100、
归1；第三行按键对应第一路DDS的相位字，因为第一路DDS的相位字恒为0，所以本行按键做保留
用；当按下第四行的第1、2、3、4个按键时，对应第二路DDS的相位字+1、+10、+100、归0。
本模块也做了类似矩阵键盘的设计，设置了四个寄存器存储前一时钟周期的频率字和相位字
（事实上因为一路DDS 相位字恒为0，三个即可，但增加了可拓展性），当频率字和相位字被修改
时，本模块会产生一个持续一个时钟周期的脉冲，这个脉冲会被接入DDS模块的 reset 上，当频率
字和相位字改变时，DDS会被复位，以实现两路DDS的同步。这个设计是保持相位差稳定的关键。
6. 分频器 模块
可根据输入的分频因子对时钟进行分频，比如时钟因子为2对应2分频。
7. 数码管显示模块
本模块接受来自 FPreg 的频率字和相位字信息，并将其显示在数码管上。
左二位数码管显示第一路DDS的频率字的16进制，其右二位显示第二路DDS的频率字的16进
制，其右一位显示第一路DDS的相位字（恒为0），最右三个数码管显示第二路DDS的相位字的16
进制。比如第一路和第二路频率字分别为1、63，第一路和第二路相位字分别为0、255，则数码管
显示01.3F.0.0FF.，其中小数点为分隔符。
8. DAC 模块
由例程改编而来的数模转化模块，可以接受两路DDS信号，并通过告诉切换通道使两路DDS信
号分别输出到AB两个通道。
